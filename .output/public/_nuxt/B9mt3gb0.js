import{f as J,g as K,h as R,i as W,o as r,w as v,r as X,n as M,j as Z,P as ee,k as te,l as b,m as se,c as d,b as n,a as s,p as D,d as m,q as ae,s as le,t as u,v as C,F as y,x,y as A}from"./CX9Q0U3t.js";import{_ as ne}from"./M818aj8r.js";import{_ as ie,a as oe,b as re}from"./CxjI32HF.js";const de={base:"animate-pulse rounded-md bg-elevated"},ue={__name:"Skeleton",props:{as:{type:null,required:!1},class:{type:null,required:!1}},setup(k){const _=k,h=J(),p=K(()=>{var c;return R({extend:R(de),...((c=h.ui)==null?void 0:c.skeleton)||{}})});return(c,i)=>(r(),W(Z(ee),{as:k.as,"aria-busy":"true","aria-label":"loading","aria-live":"polite",role:"alert",class:M(p.value({class:_.class}))},{default:v(()=>[X(c.$slots,"default")]),_:3},8,["as","class"]))}},ce={class:"min-h-screen"},me={class:"container mx-auto px-4 py-8"},ve={class:"space-y-6"},fe={class:"flex items-center justify-between"},pe={class:"text-3xl font-bold font-display flex items-center gap-3 text-white"},ge={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-4"},be={class:"text-center"},_e={class:"text-2xl font-bold title-gradient"},he={class:"text-center"},ye={class:"text-2xl font-bold text-green-400"},xe={class:"text-center"},Te={class:"text-2xl font-bold text-violet-400"},Ee={class:"text-center"},we={class:"text-2xl font-bold text-brass-400"},De={class:"text-lg font-semibold font-display text-white flex items-center gap-2"},Ie={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ce={class:"block text-sm font-medium text-gray-300 mb-2"},Ae=["value"],ke={class:"block text-sm font-medium text-gray-300 mb-2"},Ue=["value"],Se={class:"block text-sm font-medium text-gray-300 mb-2"},Oe=["value"],Re={class:"block text-sm font-medium text-gray-300 mb-2"},Me=["value"],$e={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Ne={class:"flex gap-2 mt-4"},Le={class:"text-lg font-semibold font-display text-white flex items-center gap-2"},Ve={key:0,class:"space-y-4"},Pe={key:1,class:"text-center py-8 text-gray-400"},He={key:2,class:"space-y-3"},je={class:"flex items-start gap-4"},Ge={class:"flex-shrink-0 mt-1"},Qe={class:"flex-1 min-w-0"},qe={class:"flex items-center gap-2 mb-2"},ze={class:"font-medium text-white"},Be={class:"text-sm text-gray-300 mb-3"},Fe={class:"flex items-center gap-4 text-xs text-gray-500"},Ye={class:"flex items-center gap-1"},Je={key:0,class:"flex items-center gap-1"},Ke={key:1,class:"flex items-center gap-1"},We={key:3,class:"flex items-center justify-between mt-6 pt-4 border-t border-gray-600/50"},Xe={class:"text-sm text-gray-400"},Ze={class:"flex gap-2"},I="https://backend.winchester-ascendancy.com/api",at=te({__name:"logs",setup(k){const _=b(!1),h=b([]),p=b(null),c=b(null),i=b({actionType:"",chestId:"",userId:"",dateRange:"",startDate:"",endDate:""}),$=[{label:"üîß Toutes les activit√©s",value:""},{label:"üì¶ Gestion des coffres",value:"chest"},{label:"üì¶ Cr√©ation de coffre",value:"CREATE_CHEST"},{label:"üóëÔ∏è Suppression de coffre",value:"DELETE_CHEST"},{label:"üì• Gestion des items",value:"item"},{label:"‚ûï Ajout d'item",value:"ADD_ITEM"},{label:"‚ûñ Suppression d'item",value:"REMOVE_ITEM"},{label:"üîÑ Modification quantit√©",value:"UPDATE_ITEM_QUANTITY"},{label:"üîê Authentification",value:"auth"},{label:"üîë Connexion",value:"LOGIN"},{label:"üö™ D√©connexion",value:"LOGOUT"}],N=[{label:"üïê Toutes les dates",value:""},{label:"üìÖ Aujourd'hui",value:"today"},{label:"üìÖ Cette semaine",value:"week"},{label:"üìÖ Ce mois",value:"month"},{label:"üìÖ Cette ann√©e",value:"year"},{label:"üìÖ 24 derni√®res heures",value:"24h"},{label:"üìÖ 7 derniers jours",value:"7d"},{label:"üìÖ 30 derniers jours",value:"30d"},{label:"üéØ P√©riode personnalis√©e",value:"custom"}],T=b([{label:"üîÑ Chargement...",value:""}]),E=b([{label:"üîÑ Chargement...",value:""}]);function L(a){return{CREATE_CHEST:"i-mdi-plus-circle",ADD_ITEM:"i-mdi-plus",REMOVE_ITEM:"i-mdi-minus",UPDATE_ITEM_QUANTITY:"i-mdi-swap-horizontal",DELETE_CHEST:"i-mdi-delete",LOGIN:"i-mdi-login",LOGOUT:"i-mdi-logout"}[a]||"i-mdi-circle"}function V(a){const e=new Date,t=new Date;switch(a){case"today":return t.setHours(0,0,0,0),{start:t,end:e};case"week":return t.setDate(e.getDate()-e.getDay()),t.setHours(0,0,0,0),{start:t,end:e};case"month":return t.setDate(1),t.setHours(0,0,0,0),{start:t,end:e};case"year":return t.setMonth(0,1),t.setHours(0,0,0,0),{start:t,end:e};case"24h":return t.setTime(e.getTime()-1440*60*1e3),{start:t,end:e};case"7d":return t.setTime(e.getTime()-10080*60*1e3),{start:t,end:e};case"30d":return t.setTime(e.getTime()-720*60*60*1e3),{start:t,end:e};default:return null}}function P(a){return{CREATE_CHEST:"text-green-400",ADD_ITEM:"text-blue-400",REMOVE_ITEM:"text-red-400",UPDATE_ITEM_QUANTITY:"text-yellow-400",DELETE_CHEST:"text-red-500",LOGIN:"text-green-500",LOGOUT:"text-gray-400"}[a]||"text-gray-400"}function H(a){return{CREATE_CHEST:"solid",ADD_ITEM:"soft",REMOVE_ITEM:"solid",UPDATE_ITEM_QUANTITY:"outline",DELETE_CHEST:"solid",LOGIN:"soft",LOGOUT:"outline"}[a]||"outline"}function j(a){return{CREATE_CHEST:"Cr√©ation",ADD_ITEM:"Ajout",REMOVE_ITEM:"Suppression",UPDATE_ITEM_QUANTITY:"Modification",DELETE_CHEST:"Suppression",LOGIN:"Connexion",LOGOUT:"D√©connexion"}[a]||a}function G(a){return{CREATE_CHEST:`Cr√©ation du coffre "${a.chestName}"`,ADD_ITEM:`Ajout de ${a.newQuantity-(a.oldQuantity||0)} ${a.itemName} dans ${a.chestName}`,REMOVE_ITEM:`Suppression de ${(a.oldQuantity||0)-a.newQuantity} ${a.itemName} dans ${a.chestName}`,UPDATE_ITEM_QUANTITY:`Modification de ${a.itemName} dans ${a.chestName} (${a.oldQuantity||0} ‚Üí ${a.newQuantity})`,DELETE_CHEST:`Suppression du coffre "${a.chestName}"`,LOGIN:"Connexion au syst√®me",LOGOUT:"D√©connexion du syst√®me"}[a.action]||a.action}function Q(a){return new Date(a).toLocaleString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}async function q(){try{const a=await fetch(`${I}/chests`,{credentials:"include"});if(a.ok){const t=await a.json();t&&t.length>0?T.value=[{label:"üè† Tous les coffres",value:""},...t.map(o=>({label:o.name||`Coffre ${o._id}`,value:o._id}))]:T.value=[{label:"üì≠ Aucun coffre disponible",value:""}]}else console.error("Erreur lors du chargement des coffres:",a.status),T.value=[{label:"‚ùå Erreur de chargement",value:""}];const e=await fetch(`${I}/logs/users`,{credentials:"include"});if(e.ok){const t=await e.json();t&&t.length>0?E.value=[{label:"üë• Tous les utilisateurs",value:""},...t.map(o=>({label:o.username||o.discordUsername||`User ${o.discordId||o._id}`,value:o._id||o.discordId}))]:E.value=[{label:"üë§ Aucun utilisateur trouv√©",value:""}]}else console.error("Erreur lors du chargement des utilisateurs:",e.status),E.value=[{label:"‚ùå Erreur de chargement",value:""}]}catch(a){console.error("Erreur lors du chargement des options:",a),T.value=[{label:"‚ùå Erreur de chargement des coffres",value:""}],E.value=[{label:"‚ùå Erreur de chargement des utilisateurs",value:""}]}}async function w(){var a,e;try{_.value=!0;const t=new URLSearchParams({page:((e=(a=c.value)==null?void 0:a.page)==null?void 0:e.toString())||"1",limit:"20"});if(i.value.actionType&&t.set("actionType",i.value.actionType),i.value.chestId&&t.set("chestId",i.value.chestId),i.value.userId&&t.set("userId",i.value.userId),i.value.dateRange==="custom"&&i.value.startDate&&i.value.endDate)t.set("startDate",i.value.startDate),t.set("endDate",i.value.endDate);else if(i.value.dateRange&&i.value.dateRange!=="custom"){const f=V(i.value.dateRange);f&&(t.set("startDate",f.start.toISOString()),t.set("endDate",f.end.toISOString()))}const[o,g]=await Promise.all([fetch(`${I}/logs?${t.toString()}`,{credentials:"include"}).then(f=>f.json()),fetch(`${I}/logs/stats`,{credentials:"include"}).then(f=>f.json())]);h.value=o.logs,c.value=o.pagination,p.value=g}catch(t){console.error("Erreur lors du chargement des logs:",t)}finally{_.value=!1}}async function S(){try{const a=await fetch(`${I}/logs/stats`,{credentials:"include"});p.value=await a.json()}catch(a){console.error("Erreur lors du chargement des statistiques:",a)}}function z(){w()}function B(){i.value={actionType:"",chestId:"",userId:"",dateRange:"",startDate:"",endDate:""},w()}function O(a){const e=new URLSearchParams({page:a.toString(),limit:"20"});Object.entries(i.value).forEach(([t,o])=>{o!==""&&e.set(t,o)}),w()}function F(){w(),S()}return se(async()=>{await Promise.all([q(),w(),S()])}),(a,e)=>{const t=ae,o=le,g=ne,f=oe,U=ue,Y=re;return r(),d("div",ce,[n(ie,{chests:[]}),s("main",me,[s("div",ve,[s("div",fe,[s("h1",pe,[n(t,{name:"i-mdi-history",class:"w-8 h-8 text-blood-400"}),e[8]||(e[8]=m(" Logs d'activit√© ",-1))]),n(o,{onClick:F,loading:_.value,class:"nav-button-subtle",size:"lg"},{default:v(()=>[n(t,{name:"i-mdi-refresh",class:"w-4 h-4 mr-2"}),e[9]||(e[9]=m(" Actualiser ",-1))]),_:1},8,["loading"])]),p.value?(r(),d("div",ge,[n(g,{class:"panel brushed ring-blood"},{default:v(()=>[s("div",be,[s("div",_e,u(p.value.totalLogs),1),e[10]||(e[10]=s("div",{class:"text-sm text-gray-300"},"Total des logs",-1))])]),_:1}),n(g,{class:"panel brushed ring-blood"},{default:v(()=>[s("div",he,[s("div",ye,u(p.value.uniqueUsers),1),e[11]||(e[11]=s("div",{class:"text-sm text-gray-300"},"Utilisateurs actifs",-1))])]),_:1}),n(g,{class:"panel brushed ring-blood"},{default:v(()=>[s("div",xe,[s("div",Te,u(p.value.uniqueChests),1),e[12]||(e[12]=s("div",{class:"text-sm text-gray-300"},"Coffres modifi√©s",-1))])]),_:1}),n(g,{class:"panel brushed ring-blood"},{default:v(()=>[s("div",Ee,[s("div",we,u(p.value.recentActivity),1),e[13]||(e[13]=s("div",{class:"text-sm text-gray-300"},"Activit√© r√©cente (24h)",-1))])]),_:1})])):D("",!0),n(g,{class:"panel brushed ring-blood"},{header:v(()=>[s("h3",De,[n(t,{name:"i-mdi-filter",class:"w-5 h-5 text-blood-400"}),e[14]||(e[14]=m(" Filtres avanc√©s ",-1))])]),default:v(()=>[s("div",Ie,[s("div",null,[s("label",Ce,[n(t,{name:"i-mdi-cog",class:"w-4 h-4 inline mr-1"}),e[15]||(e[15]=m(" Type d'activit√© ",-1))]),C(s("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.actionType=l),class:"bg-gray-800/50 border border-gray-600 rounded px-3 py-2 text-white w-full"},[e[16]||(e[16]=s("option",{value:""},"Tous les types",-1)),(r(),d(y,null,x($,l=>s("option",{key:l.value,value:l.value},u(l.label),9,Ae)),64))],512),[[A,i.value.actionType]])]),s("div",null,[s("label",ke,[n(t,{name:"i-mdi-archive",class:"w-4 h-4 inline mr-1"}),e[17]||(e[17]=m(" Coffre ",-1))]),C(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.chestId=l),class:"bg-gray-800/50 border border-gray-600 rounded px-3 py-2 text-white w-full"},[e[18]||(e[18]=s("option",{value:""},"Tous les coffres",-1)),(r(!0),d(y,null,x(T.value,l=>(r(),d("option",{key:l.value,value:l.value},u(l.label),9,Ue))),128))],512),[[A,i.value.chestId]])]),s("div",null,[s("label",Se,[n(t,{name:"i-mdi-account",class:"w-4 h-4 inline mr-1"}),e[19]||(e[19]=m(" Utilisateur ",-1))]),C(s("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.userId=l),class:"bg-gray-800/50 border border-gray-600 rounded px-3 py-2 text-white w-full"},[e[20]||(e[20]=s("option",{value:""},"Tous les utilisateurs",-1)),(r(!0),d(y,null,x(E.value,l=>(r(),d("option",{key:l.value,value:l.value},u(l.label),9,Oe))),128))],512),[[A,i.value.userId]])]),s("div",null,[s("label",Re,[n(t,{name:"i-mdi-calendar",class:"w-4 h-4 inline mr-1"}),e[21]||(e[21]=m(" P√©riode ",-1))]),C(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.dateRange=l),class:"bg-gray-800/50 border border-gray-600 rounded px-3 py-2 text-white w-full"},[e[22]||(e[22]=s("option",{value:""},"Toutes les dates",-1)),(r(),d(y,null,x(N,l=>s("option",{key:l.value,value:l.value},u(l.label),9,Me)),64))],512),[[A,i.value.dateRange]])])]),i.value.dateRange==="custom"?(r(),d("div",$e,[n(f,{modelValue:i.value.startDate,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.startDate=l),type:"datetime-local",placeholder:"Date de d√©but",icon:"i-mdi-calendar-start",class:"bg-gray-800/50 border-gray-600"},null,8,["modelValue"]),n(f,{modelValue:i.value.endDate,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.endDate=l),type:"datetime-local",placeholder:"Date de fin",icon:"i-mdi-calendar-end",class:"bg-gray-800/50 border-gray-600"},null,8,["modelValue"])])):D("",!0),s("div",Ne,[n(o,{onClick:z,class:"nav-button-subtle",size:"md"},{default:v(()=>[n(t,{name:"i-mdi-check",class:"w-4 h-4 mr-2"}),e[23]||(e[23]=m(" Appliquer les filtres ",-1))]),_:1}),n(o,{onClick:B,variant:"outline",color:"gray",size:"md"},{default:v(()=>[n(t,{name:"i-mdi-refresh",class:"w-4 h-4 mr-2"}),e[24]||(e[24]=m(" R√©initialiser ",-1))]),_:1})])]),_:1}),n(g,{class:"panel brushed ring-blood"},{header:v(()=>[s("h3",Le,[n(t,{name:"i-mdi-timeline",class:"w-5 h-5 text-blood-400"}),e[25]||(e[25]=m(" Historique des actions ",-1))])]),default:v(()=>[_.value&&!h.value.length?(r(),d("div",Ve,[(r(),d(y,null,x(5,l=>s("div",{key:l,class:"tooltip-surface p-4"},[n(U,{class:"h-4 w-32 mb-2"}),n(U,{class:"h-3 w-full mb-1"}),n(U,{class:"h-3 w-3/4"})])),64))])):h.value.length===0?(r(),d("div",Pe,[n(t,{name:"i-mdi-history",class:"w-12 h-12 mx-auto mb-4 opacity-50 text-blood-400"}),e[26]||(e[26]=s("p",{class:"text-gray-300"},"Aucun log trouv√©",-1))])):(r(),d("div",He,[(r(!0),d(y,null,x(h.value,l=>(r(),d("div",{key:l._id,class:"tooltip-surface p-4 hover:bg-gray-800/30 transition-colors"},[s("div",je,[s("div",Ge,[n(t,{name:L(l.action),class:M([P(l.action),"w-5 h-5"])},null,8,["name","class"])]),s("div",Qe,[s("div",qe,[s("span",ze,u(l.username),1),n(Y,{variant:H(l.action),size:"xs",class:"chip--accent"},{default:v(()=>[m(u(j(l.action)),1)]),_:2},1032,["variant"])]),s("p",Be,u(l.details||G(l)),1),s("div",Fe,[s("span",Ye,[n(t,{name:"i-mdi-clock",class:"w-3 h-3"}),m(" "+u(Q(l.createdAt)),1)]),l.chestName?(r(),d("span",Je,[n(t,{name:"i-mdi-treasure-chest",class:"w-3 h-3"}),m(" "+u(l.chestName),1)])):D("",!0),l.itemName?(r(),d("span",Ke,[n(t,{name:"i-mdi-package-variant",class:"w-3 h-3"}),m(" "+u(l.itemName),1)])):D("",!0)])])])]))),128))])),c.value&&c.value.pages>1?(r(),d("div",We,[s("div",Xe," Page "+u(c.value.page)+" sur "+u(c.value.pages)+" ("+u(c.value.total)+" logs au total) ",1),s("div",Ze,[n(o,{onClick:e[6]||(e[6]=l=>O(c.value.page-1)),disabled:!c.value.hasPrev,class:"nav-button-subtle",size:"sm"},{default:v(()=>[n(t,{name:"i-mdi-chevron-left",class:"w-4 h-4"}),e[27]||(e[27]=m(" Pr√©c√©dent ",-1))]),_:1},8,["disabled"]),n(o,{onClick:e[7]||(e[7]=l=>O(c.value.page+1)),disabled:!c.value.hasNext,class:"nav-button-subtle",size:"sm"},{default:v(()=>[e[28]||(e[28]=m(" Suivant ",-1)),n(t,{name:"i-mdi-chevron-right",class:"w-4 h-4"})]),_:1},8,["disabled"])])])):D("",!0)]),_:1})])])])}}});export{at as default};
