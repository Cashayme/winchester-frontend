import{a_ as c,a$ as i,z as s}from"./CX9Q0U3t.js";const p=c(async(o,l)=>{let e,r;if(["/chests","/logs","/"].some(t=>o.path===t||o.path.startsWith(`${t}/`)))try{console.log("🔐 Vérification de l'authentification pour:",o.path);const t="https://backend.winchester-ascendancy.com/api",a=([e,r]=i(()=>fetch(`${t}/auth/me`,{credentials:"include"})),e=await e,r(),e);if(a.ok){const h=([e,r]=i(()=>a.json()),e=await e,r(),e),n=([e,r]=i(()=>fetch(`${t}/chests`,{credentials:"include"})),e=await e,r(),e);if(n.ok){console.log("✅ Utilisateur authentifié et autorisé");return}else return n.status===403?(console.log("🚫 Utilisateur authentifié mais accès refusé"),s("/login?error=access_denied")):(console.log("❌ Erreur lors de la vérification des autorisations"),s("/login?error=server_error"))}else return console.log("🔒 Utilisateur non authentifié, redirection vers /login"),s(`/login?redirect=${encodeURIComponent(o.fullPath)}`)}catch(t){return console.error("❌ Erreur lors de la vérification d'authentification:",t),s("/login?error=network_error")}});export{p as default};
